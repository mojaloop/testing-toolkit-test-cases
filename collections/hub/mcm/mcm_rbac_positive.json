{
  "name": "MCM RBAC - Positive Authorization Tests",
  "test_cases": [
    {
      "id": "mcm-dfsp-list-with-permission",
      "name": "Admin can list all DFSPs",
      "meta": {
        "info": "Test that admin with dfspList permission can access GET /api/dfsps"
      },
      "requests": [
        {
          "id": "list-dfsps-authorized",
          "description": "GET /api/dfsps with dfspList permission",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "mcm"
          },
          "operationPath": "/dfsps",
          "path": "/dfsps",
          "method": "get",
          "url": "{$inputs.MCM_URL}",
          "headers": {
            "Cookie": "ory_kratos_session={$inputs.PORTAL_ADMIN_SESSION}"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Response status to be 200",
                "exec": [
                  "expect(response.status).to.equal(200)"
                ]
              },
              {
                "id": 2,
                "description": "Response should be an array",
                "exec": [
                  "expect(response.body).to.be.an('array')"
                ]
              }
            ]
          }
        }
      ]
    },
    {
      "id": "mcm-dfsp-list-dfsp-operator",
      "name": "DFSP operator can list DFSPs (filtered to own)",
      "meta": {
        "info": "Test that DFSP operator with dfspList permission can access GET /api/dfsps (returns filtered list)"
      },
      "requests": [
        {
          "id": "list-dfsps-dfsp-operator",
          "description": "GET /api/dfsps as DFSP operator",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "mcm"
          },
          "operationPath": "/dfsps",
          "path": "/dfsps",
          "method": "get",
          "url": "{$inputs.MCM_URL}",
          "headers": {
            "Cookie": "ory_kratos_session={$inputs.DFSP1_OPERATOR_SESSION}"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Response status to be 200",
                "exec": [
                  "expect(response.status).to.equal(200)"
                ]
              },
              {
                "id": 2,
                "description": "Response should be an array",
                "exec": [
                  "expect(response.body).to.be.an('array')"
                ]
              }
            ]
          }
        }
      ]
    },
    {
      "id": "mcm-dfsp-owner-credentials",
      "name": "DFSP owner can access own credentials",
      "meta": {
        "info": "Test that DFSP owner (role: dfsp:DFSPID member) can access credentials"
      },
      "requests": [
        {
          "id": "get-own-credentials",
          "description": "GET /api/dfsps/{dfspId}/credentials as owner",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "mcm"
          },
          "operationPath": "/dfsps/{dfspId}/credentials",
          "path": "/dfsps/{$inputs.DFSP1_ID}/credentials",
          "method": "get",
          "url": "{$inputs.MCM_URL}",
          "headers": {
            "Cookie": "ory_kratos_session={$inputs.DFSP1_OPERATOR_SESSION}"
          },
          "params": {
            "dfspId": "{$inputs.DFSP1_ID}"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Response status to be 200",
                "exec": [
                  "expect(response.status).to.equal(200)"
                ]
              }
            ]
          }
        }
      ]
    },
    {
      "id": "mcm-hub-endpoints-view",
      "name": "Admin can read hub endpoints",
      "meta": {
        "info": "Test that admin with hubEndpointsView permission can GET /api/hub/endpoints"
      },
      "requests": [
        {
          "id": "get-hub-endpoints",
          "description": "GET /api/hub/endpoints with hubEndpointsView permission",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "mcm"
          },
          "operationPath": "/hub/endpoints",
          "path": "/hub/endpoints",
          "method": "get",
          "url": "{$inputs.MCM_URL}",
          "headers": {
            "Cookie": "ory_kratos_session={$inputs.PORTAL_ADMIN_SESSION}"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Response status to be 200",
                "exec": [
                  "expect(response.status).to.equal(200)"
                ]
              }
            ]
          }
        }
      ]
    },
    {
      "id": "mcm-hub-endpoints-view-dfsp-operator",
      "name": "DFSP operator can read hub endpoints",
      "meta": {
        "info": "Test that DFSP operator with hubEndpointsView permission can GET /api/hub/endpoints"
      },
      "requests": [
        {
          "id": "get-hub-endpoints-dfsp",
          "description": "GET /api/hub/endpoints as DFSP operator",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "mcm"
          },
          "operationPath": "/hub/endpoints",
          "path": "/hub/endpoints",
          "method": "get",
          "url": "{$inputs.MCM_URL}",
          "headers": {
            "Cookie": "ory_kratos_session={$inputs.DFSP1_OPERATOR_SESSION}"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Response status to be 200",
                "exec": [
                  "expect(response.status).to.equal(200)"
                ]
              }
            ]
          }
        }
      ]
    },
    {
      "id": "mcm-hub-endpoints-manage",
      "name": "User with hubEndpointsManage can create hub endpoints",
      "meta": {
        "info": "Test that user with hubEndpointsManage permission can POST /api/hub/endpoints/ingress/ips"
      },
      "requests": [
        {
          "id": "create-hub-ingress-ip",
          "description": "POST /api/hub/endpoints/ingress/ips with hubEndpointsManage permission",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "mcm"
          },
          "operationPath": "/hub/endpoints/ingress/ips",
          "path": "/hub/endpoints/ingress/ips",
          "method": "post",
          "url": "{$inputs.MCM_URL}",
          "headers": {
            "Cookie": "ory_kratos_session={$inputs.PORTAL_ADMIN_SESSION}",
            "Content-Type": "application/json"
          },
          "body": {
            "value": {
              "address": "192.168.1.1",
              "ports": ["443"]
            }
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Response status to be 200 or 201",
                "exec": [
                  "expect([200, 201]).to.include(response.status)"
                ]
              }
            ]
          }
        }
      ]
    },
    {
      "id": "mcm-monetary-zones-view",
      "name": "User with monetaryZonesView can list monetary zones",
      "meta": {
        "info": "Test that user with monetaryZonesView permission can GET /api/monetaryzones"
      },
      "requests": [
        {
          "id": "get-monetary-zones",
          "description": "GET /api/monetaryzones with monetaryZonesView permission",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "mcm"
          },
          "operationPath": "/monetaryzones",
          "path": "/monetaryzones",
          "method": "get",
          "url": "{$inputs.MCM_URL}",
          "headers": {
            "Cookie": "ory_kratos_session={$inputs.PORTAL_ADMIN_SESSION}"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Response status to be 200",
                "exec": [
                  "expect(response.status).to.equal(200)"
                ]
              }
            ]
          }
        }
      ]
    },
    {
      "id": "mcm-jws-certs-view",
      "name": "Admin with dfspJwsCertsView can view JWS certificates",
      "meta": {
        "info": "Test that admin with dfspJwsCertsView permission can GET /api/dfsps/jwscerts"
      },
      "requests": [
        {
          "id": "get-jws-certs",
          "description": "GET /api/dfsps/jwscerts with dfspJwsCertsView permission",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "mcm"
          },
          "operationPath": "/dfsps/jwscerts",
          "path": "/dfsps/jwscerts",
          "method": "get",
          "url": "{$inputs.MCM_URL}",
          "headers": {
            "Cookie": "ory_kratos_session={$inputs.PORTAL_ADMIN_SESSION}"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Response status to be 200",
                "exec": [
                  "expect(response.status).to.equal(200)"
                ]
              }
            ]
          }
        }
      ]
    },
    {
      "id": "mcm-jws-certs-view-dfsp-operator",
      "name": "DFSP operator can view JWS certificates",
      "meta": {
        "info": "Test that DFSP operator with dfspJwsCertsView permission can GET /api/dfsps/jwscerts"
      },
      "requests": [
        {
          "id": "get-jws-certs-dfsp",
          "description": "GET /api/dfsps/jwscerts as DFSP operator",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "mcm"
          },
          "operationPath": "/dfsps/jwscerts",
          "path": "/dfsps/jwscerts",
          "method": "get",
          "url": "{$inputs.MCM_URL}",
          "headers": {
            "Cookie": "ory_kratos_session={$inputs.DFSP1_OPERATOR_SESSION}"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Response status to be 200",
                "exec": [
                  "expect(response.status).to.equal(200)"
                ]
              }
            ]
          }
        }
      ]
    },
    {
      "id": "mcm-dfsp-endpoints-unprocessed",
      "name": "User with dfspManage can access unprocessed endpoints",
      "meta": {
        "info": "Test that user with dfspManage permission can GET /api/dfsps/endpoints/unprocessed"
      },
      "requests": [
        {
          "id": "get-unprocessed-endpoints",
          "description": "GET /api/dfsps/endpoints/unprocessed with dfspManage permission",
          "apiVersion": {
            "minorVersion": 0,
            "majorVersion": 1,
            "type": "mcm"
          },
          "operationPath": "/dfsps/endpoints/unprocessed",
          "path": "/dfsps/endpoints/unprocessed",
          "method": "get",
          "url": "{$inputs.MCM_URL}",
          "headers": {
            "Cookie": "ory_kratos_session={$inputs.PORTAL_ADMIN_SESSION}"
          },
          "tests": {
            "assertions": [
              {
                "id": 1,
                "description": "Response status to be 200",
                "exec": [
                  "expect(response.status).to.equal(200)"
                ]
              }
            ]
          }
        }
      ]
    }
  ]
}
